// conf/hpc.config
// -----------------
// General HPC configuration template suitable for SGE-based clusters
// Can be updated for other HPC sites (SLURM, PBS/Torque, LSF) 
//
// Goals of this file:
//  - Provide a working default for SGE-based systems (Apocrita)
//  - Show examples and placeholders users must change for their cluster
//  - Demonstrate how to override resource requests per-process via labels
//
// Quick adaptation checklist for a new HPC site:
//  1. Change `process.executor` to the scheduler your site uses ('sge',
//     'slurm', 'pbs', or omit for Ignite/MPI parallel runs).
//  2. Update `queue` (SGE) or `partition` (SLURM) to a valid cluster queue.
//  3. Adjust `clusterOptions` to match the scheduler flags your site expects
//     (examples for SGE and SLURM shown below).
//  4. Tune `maxForks`, `cpus`, `memory`, and label-specific blocks to match
//     local quotas and walltime limits.
//  5. Test with a small job (short walltime, small memory) before scaling up.

process {
  // Default executor for serial-submission mode. Set to 'sge' for Apocrita.
  // Examples for other schedulers:
  //   Slurm:   executor = 'slurm'
  //   PBS/Torque: executor = 'pbs'
  //   Ignite (MPI): omit or set executor = 'ignite'
  executor = 'sge'

  // Default queue/partition â€“ change to a queue name valid on your cluster
  queue = 'standard'

  // clusterOptions: extra scheduler options sent to the submit command.
  // SGE example: request 1 core, 4GB per-core, 2 hours walltime
  //   '-pe smp 1 -l h_vmem=4G,h_rt=2:0:0'
  // Slurm equivalent (if using slurm executor) might use partition/QoS flags:
  //   '--partition=short --mem=4G --time=02:00:00'
  clusterOptions = '-pe smp 1 -l h_vmem=4G,h_rt=2:0:0'

  // Limit concurrent forks in the master job to avoid hitting scheduler limits
  maxForks = 8

  // Default error strategy and retry policy for task failures
  errorStrategy = 'retry'
  maxRetries = 2

  // Per-label resource presets (override defaults). Use labels in your
  // pipeline processes (process { label 'heavy' }) to pick these presets.
  // Adjust cpus/memory/time to match typical jobs under that label.
  withLabel: 'heavy' {
    cpus   = 12
    memory = '48 GB'
    time   = '24h'
    // If you need label-specific cluster options (e.g. request more cores):
    // clusterOptions = '-pe smp 12 -l h_vmem=4G,h_rt=24:0:0'
  }
}

params {
  // Small default to avoid overwriting interactive/local outputs
  outdir = "${params.output_path}_hpc"
}
