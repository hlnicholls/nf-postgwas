// conf/base.config
// Base executor + reporting. Assumes you activate conda env externally.
// Writes NF reports under ${params.outdir}/Reports.
// :contentReference[oaicite:4]{index=4} :contentReference[oaicite:5]{index=5}

process {
  executor = 'local'
  // Sensible defaults; refine per-process later via labels
  cpus    = 8
  memory  = '32 GB'
  errorStrategy = 'retry'
  maxRetries    = 2
  maxForks      = 2

  // Resource presets by label (keeps things safe by default)
  withLabel: 'light' {
    cpus = 1
    memory = '2 GB'
    time = '1h'
  }

  withLabel: 'medium' {
    cpus = 2
    memory = '8 GB'
    time = '3h'
    // Optional: uncomment to ensure only one medium task at a time
    // maxForks = 1
  }

  // Targeted tweaks for specific tasks if needed
  withName: 'MANHATTAN_QC' {
    cpus   = 4
    memory = '4 GB'
    time   = '3h'
  }

  withName: 'REGIONAL_PLOTS' {
    cpus   = 4
    memory = '4 GB'
    time   = '3h'
  }

  withName: 'CLEAN_FOR_LDSC' {
    cpus   = 4
    memory = '4 GB'
    time   = '2h'
  }

  withName: 'RUN_HERITABILITY' {
    cpus   = 4
    memory = '4 GB'
    time   = '3h'
  }

  withName: 'RUN_GENETIC_CORR' {
    cpus   = 4
    memory = '4 GB'
    time   = '3h'
    // This aggregates across traits; keep concurrency low globally via base maxForks
  }

  withName: 'CLEAN_LDSC_LOGS' {
    cpus   = 1
    memory = '2 GB'
    time   = '1h'
  }

  // Loci compilation runs in parallel with plots/LDSC; cap at 8 GB as requested
  withName: 'COMPILE_LOCI_ALL' {
    cpus   = 8
    memory = '8 GB'
    time   = '2h'
  }

  // CADD annotation can take longer for large datasets
  withName: 'VARIANT_ANNOT_CADD' {
    time   = '24h'
  }
}

timeline {
  enabled = true
  file    = "${params.outdir}/Reports/timeline.html"
}
report {
  enabled = true
  file    = "${params.outdir}/Reports/report.html"
}
trace {
  enabled = true
  file    = "${params.outdir}/Reports/trace.txt"
}
dag {
  enabled = true
  file    = "${params.outdir}/Reports/dag.svg"
}
