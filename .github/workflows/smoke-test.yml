name: Smoke test

on:
  workflow_dispatch:
  push:
    paths:
      - 'tests/**'
      - 'main.nf'
      - 'modules/**'

jobs:
  smoke:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '11'
      - name: Install Nextflow
        run: |
          curl -s https://get.nextflow.io | bash
          chmod +x nextflow
      - name: Run smoke test
        run: |
          # Ensure the local test wrapper is executable
          chmod +x ./bin/nf-test || true
          # Install nf-test runtime (installer will place runtime under $HOME/.nf-test)
          wget -qO- https://get.nf-test.com | bash
          # Run the repository test harness
          ./bin/nf-test test
